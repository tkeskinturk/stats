---
title: "Soc722 - DV Chapters 5"
author: "Turgut Keskint√ºrk"
date: '2022-09-15'
output:
  html_document:
    theme: united
    toc: true
    number_sections: true
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Hello there! Let's start with our exercises for Kieran Healy's Data Visualization, Chapter 5.

# Set-Up

```{r}

# load the best package in the world and some others
library(tidyverse)
library(ggrepel)

# read in the data 
wncaa <- read_csv("./data/wncaa.csv")

# glimpse the data 
glimpse(wncaa)

```

# Responses to Questions

## Question 1

OK, we are going to start with some summarizing tricks.

```{r}

champs <- wncaa %>%
  filter(tourney_finish == "Champ") %>%
  group_by(school) %>%
  summarize(n = n()) %>%
  mutate(per_tour = (n / sum(n))*100)

champs %>%
  ggplot(aes(x = reorder(school, per_tour), per_tour)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_bw() +
  labs(title = "The Percentage of Tournaments by School",
       x = "School", y = "Percentage of Tournaments") +
  coord_flip()

```

It seems that **UConn** and **Tennessee** just rock the show together!

## Question 2

Let's first get the names of the champions and create a dataset.

```{r}

# get the names

champ_names <- unique(champs$school) # Aha, good old dolar sign!

# filter the original dataset

winners <- wncaa %>% 
  filter(school %in% champ_names)

```

Before going to the plots, let's include the average seed for the teams.

```{r}

winners <- winners %>%
  group_by(school) %>%
  summarise(av_seed = mean(seed)) %>%
  ungroup() %>%
  left_join(winners, by = "school")

```


OK, nice. We are going to create a boxplot for the seeds to understand how winners start the seasons.

```{r}

winners %>%
  ggplot(aes(x = reorder(school, av_seed), seed)) +
  geom_boxplot(fill = "steelblue", col = "black") +
  theme_bw() +
  labs(title = "The Seed Distributions Across Schools",
       x = "Schools", y = "Seed") +
  coord_flip()

```

Hmm... I had no idea what a seed meant before Googling. Then it makes sense that Tennessee and UConn take the winner seeds, right?

OK, the best ones on the road: violin plots!

```{r}

winners %>%
  ggplot(aes(x = reorder(school, av_seed), seed)) +
  geom_violin(fill = "steelblue", col = "black") +
  theme_bw() +
  labs(title = "The Seed Distributions Across Schools",
       x = "Schools", y = "Seed") +
  coord_flip()

```

Meh. Usually, violin plots are really informative, though this time they look pretty ugly.

## Question 3

OK, same plot, but with points.

```{r}

winners %>%
  ggplot(aes(x = reorder(school, av_seed), seed)) +
  geom_point() +
  theme_bw() +
  labs(title = "The Seed Distributions Across Schools",
       x = "Schools", y = "Seed") +
  coord_flip()

```

Well, *overplotting* makes us bored with a lot of things. Let's jitter?

## Question 4

Alright, now we are going to use ``summarize_if`` to calculate the mean and standard deviation.

```{r}

winners_summarized <- winners %>%
  group_by(school) %>%
  summarize_if(
    is.numeric, list(mean = mean, sd = sd), na.rm = TRUE
  ) %>%
  ungroup()

```

OK, we have the data. We are going to make a dot plot.

```{r}

winners_summarized %>%
  ggplot(aes(x = reg_percent_mean, 
             y = reorder(school, reg_percent_mean))) + 
  geom_point() +
  theme_bw() +
  labs(title = "Mean of the Winners",
       x = "School", y = "Mean Value")

```

UConn shows the most percentage of mean for the seasons. Let's add the standard deviations as well.

```{r}

winners_summarized %>%
  ggplot(aes(x = reg_percent_mean, 
             y = reorder(school, reg_percent_mean))) +
  geom_pointrange(aes(xmin = reg_percent_mean - reg_percent_sd,
                      xmax = reg_percent_mean + reg_percent_sd)) +
  theme_bw() +
  labs(title = "Mean of the Winners",
       x = "School", y = "Mean Value")

```

Neat! We can always do this with ``geom_linerange``, too. Let's try.

```{r}

winners_summarized %>%
  ggplot(aes(x = reg_percent_mean, 
             y = reorder(school, reg_percent_mean))) +
  geom_point() +
  geom_linerange(aes(xmin = reg_percent_mean - reg_percent_sd,
                     xmax = reg_percent_mean + reg_percent_sd)) +
  theme_bw() +
  labs(title = "Mean of the Winners",
       x = "School", y = "Mean Value")

```

We added the ``geom_point`` as well, to keep the mean points.

## Question 5

OK, we are now trying to understand the relationship between the performance in the tournament and the full performance.

```{r}

winners %>%
  ggplot(aes(reg_percent, y = full_percent)) +
  geom_point() +
  geom_abline() +
  labs(title = "Relationship Between Tournament Performance and Full Performance",
       x = "Tournament Percentage", y = "Full Percentage") +
  theme_bw()

```

We see that most teams are below the line, but there are some that become good after the tournament is over.

## Question 6

Let's make a variable that takes 1 if that team ended up winning the tournament or a 0 otherwise.

```{r}

winners <- winners %>% 
  mutate(is_champ = if_else(tourney_finish == "Champ", 1, 0), 
         is_champ = as.factor(is_champ))

```

OK, we are going to color the plot above to understand the performance of the tournament winners.

```{r}

winners %>%
  ggplot(aes(reg_percent, y = full_percent, group = is_champ, col = is_champ)) +
  geom_point() +
  geom_abline() +
  labs(title = "Relationship Between Tournament Performance and Full Performance",
       x = "Tournament Percentage", y = "Full Percentage") +
  theme_bw() + labs(color = "Champion?") + theme(legend.position = "top")

```

``is_champ`` should be a factor because if we feed this variable to the ``ggplot`` as numeric, the legends (and colors) will be plotted as if the variable itself is continuous. Instead, we want to understand the winners and non-winners, as two categories.

Yes, it seems that champions become much better. This makes sense.

## Question 7

We are now going to label these points. Let's create the variables needed.

```{r}

# labels

winners <- winners %>% 
  mutate(plot_label = paste(school, year, sep = "-"))

# performance difference

winners <- winners %>% 
  mutate(difference = full_percent - reg_percent) 

```

OK, let's look at the points now.

```{r}

winners %>%
  ggplot(aes(reg_percent, y = full_percent, 
             group = is_champ, col = is_champ)) +
  geom_point() +
  geom_abline() +
  geom_text_repel(data = subset(winners,
                                # some subset conditions
                                (reg_percent < 50 & full_percent < 50) 
                                |
                                (reg_percent < 75 & full_percent < 75 & is_champ == 1)),
                  mapping = aes(label = plot_label)) +
  labs(title = "Relationship Between Tournament Performance and Full Performance",
       x = "Tournament Percentage", y = "Full Percentage") +
  theme_bw() + labs(color = "Champion?") + theme(legend.position = "top")

```

Yes, **Tennessee** killed!

## Question 8

```{r}

winners %>%
  filter(full_percent == 100 & reg_percent == 100) %>%
  select(school, year)

```

Well, UConn is everywhere. Cool!

Thank you!

