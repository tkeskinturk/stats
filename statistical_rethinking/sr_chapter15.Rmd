---
title: "Soc723 - SR Chapter 15"
author: "Turgut Keskint√ºrk"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: united
    toc: true
    number_sections: false
    code_folding: "hide"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.align = "center")

# load the relevant packages
pacman::p_load(
  tidyverse,
  purrr,
  rethinking,
  rstan,
  tidybayes,
  tidybayes.rethinking,
  patchwork,
  hrbrthemes,
  knitr,
  MASS
)
theme_set(theme_ipsum_rc()) # theme set for the plots

```

Hello there! Let's start with our exercises for McElreath's *Statistical Rethinking*, Chapter 15.

# Easy Problems

## 15E1

Here is the formula for the Oceanic tools model with measurement error (where I assumed that we do not have any data on variation):

$$
\begin{aligned}
T_i &\sim Poisson(\mu_i)
\\
\text{log} \ \mu_i &= \alpha + \beta \ \text{log} \ P_{true, i}
\\
P_{obs, i} &\sim \text{Normal}(P_{true, i}, P_{\sigma, i}) \ & \ \text{Measurement Error Component}
\\
P_{true, i} &\sim \text{Normal(0, 1)} \ & \ \text{Prior for True Values}
\\
P_{\sigma, i} &\sim \text{Exponential(1)} \ & \ \text{Prior for True Variation}
\\
\alpha &\sim \text{Normal}(0, 1.5)
\\
\beta &\sim \text{Normal}(0, 1)
\end{aligned}
$$

## 15E2

The same Oceanic tools model, but with missing data component, assuming MCAR:

$$
\begin{aligned}
T_i &\sim Poisson(\mu_i)
\\
\text{log} \ \mu_i &= \alpha + \beta \ \text{log} \ P_{i}
\\
P_{i} &\sim \text{Normal}(P_{\mu}, P_{\sigma}) \ & \ \text{Missing Data Component}
\\
P_{\mu} &\sim \text{LogNormal(1, 1.5)} \ & \ \text{Prior for Values}
\\
P_{\sigma} &\sim \text{Exponential(1)} \ & \ \text{Prior for Variation}
\\
\alpha &\sim \text{Normal}(0, 1.5)
\\
\beta &\sim \text{Normal}(0, 1)
\end{aligned}
$$

# Medium Problems

## 15M1

I am assuming that this question refers to the mathematical model in page 506.

The assumption, as McElreath talks below, is simply that the missing values are randomly distributed in our data. There is no generative process that which affects the distribution of these missing values in a way that differs from the observed values.

## 15M2

Let's load the data, clean it, and fit two models, assigning a normal dude for the first and a beta dude for the latter:

```{r, message = FALSE, warning = FALSE, results = "hide"}

# data
data(milk)
d <- milk
d <- d |> mutate(
  neocortex.prop = neocortex.perc / 100,
  logmass = log(mass)
)
d1 <- list(
  K = standardize(d$kcal.per.g),
  B = standardize(d$neocortex.prop),
  M = standardize(d$logmass)
)
d2 <- list(
  K = standardize(d$kcal.per.g),
  B = d$neocortex.prop,
  M = standardize(d$logmass)
)

# normal distribution
m1 <- ulam(
  alist(
    K ~ dnorm(mu, sigma),
    mu <- a + bB*B + bM*M,
    
    ## missing value dudes
    B ~ dnorm(nu, sigma_B),
    nu ~ dnorm(0, 0.5),
    sigma_B ~ dexp(1),
    
    ## other dudes
    a ~ dnorm(0, 0.5),
    c(bB, bM) ~ dnorm(0, 0.5),
    sigma ~ dexp(1)
  ), data = d1, chains = 4, cores = 4
)

# beta distribution
m2 <- ulam(
  alist(
    K ~ dnorm(mu, sigma),
    mu <- a + bB * B + bM * M,
    
    # missing value dudes
    B ~ dbeta(nu, sigma_B),
    nu ~ dexp(1),
    sigma_B ~ dexp(1),
    
    # other dudes
    a ~ dnorm(0, 0.5),
    c(bB, bM) ~ dnorm(0, 0.5),
    sigma ~ dexp(1)
  ), data = d2, chains = 4, cores = 4
)

```

Here are the parameter estimates for the missing values, plotted side by side:

## 15M3
## 15M4
## 15M5
## 15M6































